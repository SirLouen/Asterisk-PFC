% -*-caso_de_uso_2.tex-*-
% Este fichero es parte de la plantilla LaTeX para
% la realización de Proyectos Final de Carrera, protejido
% bajo los términos de la licencia GFDL.
% Para más información, la licencia completa viene incluida en el
% fichero fdl-1.3.tex

\section{Mejorando lo presente}

\textbf{Tras haber realizado los trabajos solicitados, en la siguiente reunión con Zutano Doe, tuvimos la oportunidad de conocer su experiencia. Nosotros sabíamos que cuando viera los resultados querría más, ya que quedaba latente el hecho, que nuestra máquina Asterisk aun tenía mucho potencial por desarrollar.}

\textbf{Uno de los aspectos que notó el Sr. Doe, es que evidentemente, aún no podían cursar llamadas. Era lógico que nosotros no íbamos a ser tan atrevidos como para desarrollar un plan de marcación especifico sin antes consultar su opinión dado que aquí estaríamos entrando en el tema económico de facturación, con la compañía elegida UCA Telecom.}

\textbf{Averiguamos que Zutano, mantenía conversaciones con Alemania regularmente, ya que era el su principal proveedor de Vehículos, pero estos temas los trataba el personalmente, y no quería que nadie más pudiera cursar llamadas fuera de nuestro país. Además como es común no se fiaba que sus usuarios pudieran llamar libremente a números de tarificación extraordinaria (80X), o de pago por uso, pero sabía que los números de tarificación adicional, estaban ya demasiado extendidos en las grandes corporaciones, así que no podía de momento evitar su uso (90X). También era consciente, que la mayor parte de los clientes hoy en día, utilizan el móvil como su principal medio de comunicación, asi que quería las llamadas a móviles totalmente libres. Un último aspecto que hizo hincapié, es en la posibilidad de que los Mánager pudieran llamar a números de información telefónica (118XX), en caso que cualquiera de sus trabajadores requiriese la información. Le expresamos, que no nos pareció demasiada buena idea, ya que son bastante caros, y hoy en día la mayor parte de esa información esta e Internet, pero aún así, insistió disponer de esto, exclusivo a los Jefe de departamento. Finalmente le hicimos el apunte, que dado la falta de regulación en la actualidad de la telefonía IP, los números de emergencia, podían fallar, por eso aunque habilitaríamos el 112 no se aseguraba su correcto funcionamiento. Tampoco le afecto demasiado, ya que todos sus empleados disponían como mínimo, de su teléfono móvil particular y en el caso de los jefes un móvil de empresa.}

\textbf{Ya que su negocio empezaba a marchar, quería empezar a publicitar un número común genérico, para ofrecérselo a los clientes y poder utilizarlo con fines de Marketing, por ejemplo en sus recientes anuncios en el periodico local. Este teléfono principal, tendría que tener un sistema de interacción con el cliente más personalizado, es decir, la implementación de un IVR (Interactive Voice Response). El Sr. Doe todavía no tenía muy claro como debía operar ya que todavía no estaban sentados los cimientos de la empresa en profundidad. Nosotros le propusimos de momento la siguiente idea:}

\begin{enumerate}

\item \textbf{Al entrar la llamada, lanzar un mensaje de Bienvenida}
\item \textbf{A continuación, ofrecer numéricamente las posibilidades de contactar con cada departamento}
\item \textbf{Si no pulsa nada, volver a ofrecerle todas las posibilidades}
\item \textbf{Si sigue sin pulsar nada, entonces dirigirle al departamento de Marketing}

\end{enumerate}

\textbf{Nosotros tenemos un horario de atención al cliente restringido, por tanto sería conveniente, que si nos llaman, fuera de nuestro horario, en vez de aparecer este IVR, apareciera un mensaje que indique que no podemos atenderle, ofreciendo nuestro horario y la posibilidad de dejar un mensaje en un buzón de voz, por ejemplo del Responsable de Marketing. El horario de apertura que nos ofreció el gerente sería de Lunes a Viernes de 9h a 20h ininterrumpidas}

\textbf{Por último, ya que sacamos el tema de los buzones, también estaba interesado en poder disponer de Buzones de Voz para todos su Jefes de Departamento y para él. Todas los mensajes dejados en los contestadores irían a parar a sus correos en cualquier formato de Audio, pero además tendría que existir la posibilidad de ser almacenados en el sistema y escuchados a voluntad por cada uno de los usuarios dentro del sistema. El Sr. Zutano, adelantándose, tenía constancia que Asterisk era de origen americano, así que sugirió, que que si el menú del sistema de buzón de voz estuviese en Español sería un punto muy favorable, ya que no todos sus empleados estaban duchos en el manejo del Inglés.}

\textbf{En principio todo este planteamiento le resulto aceptable y necesario de poner en marcha cuanto antes, aunque seguramente sujeta a modificaciones en un futuro. Siendo realistas, hasta aquí es lo que suelen ofrecer el 99\% de las centralitas de telefonía ofrecidas para cualquier PYME.}

\subsection{Preparando las Llamadas Salientes}

Vamos a mejorar el anterior Plan de Marcación existente. A continuación muestro el nuevo código modificado sobre el anterior.

\lstinputlisting[title={/etc/asterisk/extensions.conf}]{../conf/extensions.conf.2}

Diseccionándolo en primer lugar podemos ver el nuevo contexto \[exterior\]. Con este contexto especificamos siguiendo los patrones específicos del Plan de Marcación definimos las posibilidades de marcación que podemos hacer para realizar llamadas a números Nacionales (tanto aquellos que empiezan por 8 como por 9), Móviles y números de información (restringiendo exclusivamente a 900, 901 y 902). 

Por otro lado, dentro de los contextos de Mánager y gerencia, podemos ver también los requisitos específicos a los que solo podrán acceder los mismo como vimos en el primer DialPlan, por el sistema jerárquico creado gracias a la utilización de los "include". Con estos específicamente, definimos marcaciones para números de información (Aquellos que empiezan por 118), y para el gerente llamadas a números internacionales de destino Alemania, que tienen como peculiaridad, que aunque tienen una marcación común de inicio, a partir del 5 dígito, la numeración es variable considerando a continuación el prefijo regional + el número local (de 3 a 9 dígitos).

En siguiente lugar, dentro del contexto \[entrantes\], hemos añadido un nuevo número Direct Dial-In que redirige a la extensión \textbf{start} considerando que sea la genérica para este contexto. En esta extensión vamos a crear nuestra Operadora Automática, tal y como esta definida en el caso de uso. Para ello vamos utilizando una combinación de Aplicaciones según su conveniencia. La idea subyacente es la siguiente:

\begin{enumerate}

\item Ponemos un contador a 0, la idea es que cuando hayamos pasado dos veces por la operadora sin resultado, desviemos la llamada según especificado en el paso número 4
\item Lanzamos el mensaje de bienvenida.
\item Comprobamos si el horario actual coincide con el horario de apertura o no. 
\item En caso que no coincida, lanzamos los mensajes de "Cerrado" y a continuación el Buzón de Voz del responsable de Marketing
\item En caso que si coincida, nos vamos a la etiqueta "bienvenida" y a partir de ahí lanzamos el menú contextual para dar la opción a marcar una u otra opción. 
\item Si no pulsa nada pasado el mensaje + 1 segundo, desviamos a la extensión "relative timeout" 
\item Desde aquí comprobamos cuantas veces hemos pasado por aquí, si solo fue una vez, entonces volvemos al principio del algoritmo
\item En cambio si fueron ya dos veces, mandamos la extensión a Marketing.

\end{enumerate}

Finalmente, hemos modificado todas las extensiones especificas de los Mánager, para adaptarlas al uso de Buzón de Voz. Nótese, que hemos añadido una restriccion temporal en la aplicación de llamada Dila a 30 segundos, pasados los cuales, se ejecutaría la aplicación de grabación de mensajes de Buzones de Voz. . Por último hemos añadido extensiones especificas para el acceso a los buzones de sus respectivos usuarios, marcando primero el 9 y a continuación el número de la extensión.